{"version":3,"file":"BaseExpandList.es.js","sources":["../../../src/components/BaseExpandList/BaseExpandList.vue"],"sourcesContent":["<template>\n  <div class=\"base-expand-list\">\n    <!-- List items with clickable head to expand body -->\n    <div\n      :class=\"['base-box-shadow', { 'base-box-shadow--edit': edit }]\">\n      <ul\n        v-if=\"!edit\">\n        <BaseExpandListRow\n          v-for=\"(items, index) in data\"\n          v-show=\"index < (showAll ? data.length : minItems)\"\n          ref=\"baseExpandListRow\"\n          :key=\"index\"\n          :parent-index=\"index\"\n          :data=\"items\"\n          :multiple=\"multiple\"\n          render-as=\"li\"\n          @expanded-state=\"emitExpandedState\">\n          <template\n            #content=\"props\">\n            <!-- @slot a slot to provide customized entry row\n              @binding {Object} data - an object in `data` array -->\n            <slot\n              name=\"content\"\n              :data=\"props.data\" />\n          </template>\n        </BaseExpandListRow>\n      </ul>\n\n      <!-- List items in draggable area -->\n      <template\n        v-if=\"edit\">\n        <div\n          aria-live=\"assertive\"\n          class=\"supportive-text\">\n          {{ assertiveText }}\n        </div>\n\n        <p\n          :id=\"`draggable-${_uid}`\"\n          class=\"supportive-text\">\n          {{ supportiveText['description'] }}\n        </p>\n\n        <div\n          ref=\"baseExpandListDraggable\"\n          tabindex=\"0\"\n          :aria-labelledby=\"`draggable-${_uid}`\"\n          class=\"base-expand-list__draggable\">\n          <draggable\n            v-model=\"dataInt\"\n            :draggable=\"'.base-expand-list__draggable__item'\"\n            :handle=\"dragHandle\"\n            :disabled=\"disabled\"\n            animation=\"150\"\n            class=\"base-expand-list__draggable\">\n            <BaseExpandListRow\n              v-for=\"(item, index) in dataInt\"\n              ref=\"baseExpandListRow\"\n              :key=\"index\"\n              :data=\"item\"\n              :edit=\"true\"\n              :edit-hide-text=\"editHideText\"\n              :edit-show-text=\"editShowText\"\n              :control-type=\"controlType\"\n              :disabled=\"disabled\"\n              class=\"base-expand-list__draggable__item\"\n              @supportive=\"supportive($event, index)\"\n              @sorted=\"sort($event, index)\"\n              @update:data=\"updateData($event, index)\" />\n          </draggable>\n        </div>\n      </template>\n    </div>\n\n    <BaseButton\n      v-if=\"!edit && data.length > minItems\"\n      :id=\"`base-expand-list-${_uid}`\"\n      :aria-expanded=\"showAll ? 'true' : 'false'\"\n      :has-background-color=\"false\"\n      icon=\"drop-down\"\n      icon-position=\"right\"\n      :text=\"showAll ? showLessText : showMoreText\"\n      :class=\"{ 'base-button-icon-rotate-180': showAll }\"\n      @clicked=\"showAll = !showAll\" />\n  </div>\n</template>\n\n<script>\nimport BaseButton from '@/components/BaseButton/BaseButton';\nimport BaseExpandListRow from './BaseExpandListRow';\n\nexport default {\n  name: 'BaseExpandList',\n  components: {\n    BaseButton,\n    BaseExpandListRow,\n    Draggable: () => import('vuedraggable').then(m => (m.default || m)),\n  },\n  props: {\n    /**\n     * should be an object array with the following properties:\n     *  **label** `string` - the displayed label\n     *  **id** `string` - an identifier\n     *  **data** `Object[]` - an object array with the property:\n     *    \\* **label** `string` (renders component as\n     *    expandable row) or\n     *    * **value** `string` (renders component as entry row)\n     *\n     * optional properties:\n     *  **count** `number` - used for the number shown in brackets\n     *    (else the array length will be used)\n     *  **hidden** `boolean` - used to set visibility and is set in edit mode to toggle item\n     *\n     *  the `.sync` modifier might be used on this prop\n     */\n    data: {\n      type: Array,\n      default: () => [],\n    },\n    /**\n     * set edit mode from outside\n     */\n    edit: {\n      type: Boolean,\n      default: false,\n    },\n    /**\n     * specify number of minimal displayed items\n     */\n    minItems: {\n      type: Number,\n      default: 3,\n    },\n    /**\n     * expand multiple items\n     */\n    multiple: {\n      type: Boolean,\n      default: false,\n    },\n    /**\n     * button text to show more content\n     */\n    showMoreText: {\n      type: String,\n      default: 'Show all',\n    },\n    /**\n     * button text to show less content\n     */\n    showLessText: {\n      type: String,\n      default: 'Show less',\n    },\n    /**\n     * button text to hide item\n     */\n    editHideText: {\n      type: String,\n      default: 'Hide',\n    },\n    /**\n     * button text to show item\n     */\n    editShowText: {\n      type: String,\n      default: 'Show',\n    },\n    /**\n     * additional texts for screen-reader users to order items.\n     *   object that needs to have the following properties:\n     *   **activate**: Text read when item is focused, use variable {state} to\n     *    announce item visibility - specify text used in properties 'hidden' and 'visible'\n     *   **activated**: Text read after item was activated (selected by enter key)\n     *   **description**: Text read on initial list focus\n     *   **moved**: Text read after item was moved; can contain variables {pos} (for new position) and {total}\n     *   **visible**: string substituted to 'activate' text for state variable if item is visible\n     *   **hidden**: string substituted to 'activate' text for state variable if item is hidden\n     *\n     */\n    supportiveText: {\n      type: Object,\n      default: () => ({\n        activate: 'Use the Enter key to select item. Item is currently {state}',\n        activated: 'Item selected. Use arrow keys to order item.',\n        description: 'Use Tab key to navigate to item an order item.',\n        moved: 'Item moved: {pos} of {total}',\n        visible: 'visible',\n        hidden: 'hidden',\n      }),\n      validator: val => Object.keys(val)\n        .every(key => ['activate', 'activated', 'description', 'moved', 'visible', 'hidden'].includes(key)),\n    },\n    /**\n     * specify the type of visibility switch in edit mode\n     *  **button**: a [BaseButton](BaseButton) without text\n     *  **toggle**: a [BaseToggle](BaseToggle) element without text\n     */\n    controlType: {\n      type: String,\n      default: 'button',\n      validator: val => ['button', 'toggle'].includes(val),\n    },\n    /**\n     * define which items are expanded\n     */\n    expanded: {\n      type: Array,\n      default: () => [],\n    },\n    /**\n     * option to disable the edit functionalities of the element (toggle and draggable)\n     */\n    disabled: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      assertiveText: '',\n      showAll: false,\n      dataSorted: null,\n      originalData: null,\n      dragHandle: '',\n    };\n  },\n  computed: {\n    // the data array computed for draggable\n    dataInt: {\n      get() {\n        return this.dataSorted || this.data;\n      },\n      set(val) {\n        this.dataSorted = val;\n      },\n    },\n  },\n  watch: {\n    dataSorted: {\n      handler(val) {\n        // check if update is actually done by user during edit mode\n        // (this is the only time internal data should change!)\n        if (this.edit && JSON.stringify(val) !== JSON.stringify(this.data)) {\n          /**\n           * event emitted when data change internally (e.g. sorting, toggling hidden, etc.).\n           *  the `.sync` modifier may be used on the corresponding prop\n           *\n           * @event update:data\n           * @param {Object[]} - the modified data (e.g. from sorting)\n           */\n          this.$emit('update:data', val);\n        }\n      },\n      deep: true,\n    },\n    data: {\n      handler(val) {\n        if (JSON.stringify(val) !== JSON.stringify(this.dataSorted)) {\n          this.dataInt = JSON.parse(JSON.stringify(val));\n        }\n      },\n      deep: true,\n      immediate: true,\n    },\n    /**\n     * watch edit to create a copy of the data for the reset function\n     */\n    edit(val) {\n      this.assertiveText = '';\n      if (val) {\n        this.$nextTick(() => {\n          // set focus draggable area on edit start\n          this.$refs.baseExpandListDraggable.focus({ preventScroll: true });\n        });\n        // save a copy of original data in variable on edit activation\n        this.originalData = JSON.parse(JSON.stringify(this.data));\n      }\n    },\n    /**\n     * watch expanded state and expand items\n     */\n    expanded(val) {\n      this.expandItems(val);\n    },\n  },\n  mounted() {\n    // set draggable area depending on device touch capabilities\n    // ssr: check when component is mounted because isTouchCapable() uses window object\n    this.dragHandle = this.isTouchCapable()\n      ? ['.base-expand-item__handle']\n      : ['.base-expand-item__handle', '.base-expand-item__label'];\n  },\n  methods: {\n    /**\n     * expand items\n     *\n     * @param {Array} state - expanded state, eg: [0, 1]: level1 first item,\n     *  level2 second item is expanded\n     */\n    expandItems(state) {\n      if (!state.length) {\n        return;\n      }\n\n      // show all list items\n      if (state[0] >= this.minItems\n        && this.$refs.baseExpandListRow[state[0]]) {\n        this.showAll = true;\n      }\n\n      // first level\n      if (state[0] !== undefined\n        && this.$refs.baseExpandListRow[state[0]]) {\n        this.$refs.baseExpandListRow[state[0]].expanded = true;\n      }\n\n      // second level\n      if (state[1] !== undefined\n        && this.$refs.baseExpandListRow[state[0]].$refs.baseExpandListRow[state[1]]) {\n        this.$refs.baseExpandListRow[state[0]].$refs.baseExpandListRow[state[1]].expanded = true;\n      }\n    },\n    /**\n     * emit expanded state of items\n     * each array element represents the index of the expanded item per level\n     * eg: [0, 1]: level1 first item, level2 second item is expanded\n     *\n     * @param {Array} value - value to emit\n     */\n    emitExpandedState(value) {\n      /**\n       * event triggered when expanded state changes\n       *\n       * @event expanded-state\n       * @param {Array} - array with indices of the expanded item per level; eg: [0, 1]: level1 first item, level2 second item is expanded\n       */\n      this.$emit('expanded-state', value);\n    },\n    /**\n     * function called from BaseExpandListRow in case a prop of the data variable\n     * changes (e.g. hidden)\n     * @param {Object} rowData - the updated data of the BaseExpandListRow\n     * @param {number} index - the index in the dataInt array\n     */\n    updateData(rowData, index) {\n      this.$set(this.dataSorted, index, rowData);\n    },\n    /**\n     * sort list\n     *\n     * @param {object} obj\n     * @property {string} obj.direction - 'up' or 'down'\n     * @param {number} index - the previous index of the item in the array\n     */\n    sort({ direction }, index) {\n      // check list boundary\n      if ((direction === 'up' && index - 1 < 0)\n        || (direction === 'down' && index + 1 >= this.dataInt.length)) {\n        // current movable item (focus) needs to stay the same\n        this.$refs.baseExpandListRow[index].useSupportiveText = false;\n        this.$refs.baseExpandListRow[index].movable = true;\n        return;\n      }\n\n      // set object to new position\n      const to = direction === 'up' ? index - 1 : index + 1;\n      const from = index;\n      const data = this.dataInt;\n      data.splice(to, 0, data.splice(from, 1)[0]);\n      this.dataInt = data;\n\n      // set assertive text\n      this.assertiveText = this.supportiveText.moved\n        .replace('{pos}', to + 1)\n        .replace('{total}', this.dataInt.length);\n\n      // set current item movable (focus)\n      this.$refs.baseExpandListRow[to].useSupportiveText = false;\n      this.$refs.baseExpandListRow[to].movable = true;\n    },\n    /**\n     * reset list data - this always restores the state of the data on\n     * last save() triggered (=was triggered in parent)\n     * @public\n     */\n    reset() {\n      this.dataInt = JSON.parse(JSON.stringify(this.originalData));\n      // watcher on sortedData is not triggered here (because edit is already false)\n      // - need to propagate event to parent manually\n      this.$emit('update:data', this.dataInt);\n    },\n    /**\n     * save changed data\n     * @public\n     */\n    save() {\n      /**\n       * triggered on button click\n       * @event saved\n       * @param {object} - the data altered and ready for saving\n       */\n      this.$emit('saved', this.dataInt);\n      // update reset data copy\n      this.originalData = JSON.parse(JSON.stringify(this.dataInt));\n    },\n    /**\n     * set supportiveText for screen readers\n     *\n     * @param {string} type\n     * @param {number} index\n     */\n    supportive(type, index) {\n      const visibilityText = this.dataInt[index].hidden\n        ? this.supportiveText.hidden : this.supportiveText.visible;\n      const currentSupportString = this.supportiveText[type].replace('{state}', visibilityText);\n      if (this.assertiveText === currentSupportString) {\n        // clear temporary to trigger screen reader\n        this.assertiveText = '';\n        // screen reader needs delay to trigger aria-live message\n        setTimeout(() => {\n          this.assertiveText = currentSupportString;\n        }, 1);\n        return;\n      }\n      this.assertiveText = currentSupportString;\n    },\n    /**\n     * check touch capabilities of current device\n     *\n     * @returns {boolean|*}\n     */\n    isTouchCapable() {\n      return 'ontouchstart' in window\n        || (window.DocumentTouch && document instanceof window.DocumentTouch)\n        || navigator.maxTouchPoints > 0\n        || window.navigator.msMaxTouchPoints > 0;\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n  .base-expand-list {\n    &__draggable {\n      outline: none;\n    }\n  }\n</style>\n"],"names":["_sfc_main","BaseButton","BaseExpandListRow","m","val","key","state","value","rowData","index","direction","to","from","data","type","visibilityText","currentSupportString"],"mappings":";;;;AA2FA,MAAAA,IAAA;AAAA,EACA,MAAA;AAAA,EACA,YAAA;AAAA,IACA,YAAAC;AAAA,IACA,mBAAAC;AAAA,IACA,WAAA,MAAA,OAAA,gBAAA,KAAA,CAAAC,MAAAA,EAAA,WAAAA,CAAA;AAAA,EACA;AAAA,EACA,OAAA;AAAA,IAiBA,MAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA,MAAA,CAAA;AAAA,IACA;AAAA,IAIA,MAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA;AAAA,IACA;AAAA,IAIA,UAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA;AAAA,IACA;AAAA,IAIA,UAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA;AAAA,IACA;AAAA,IAIA,cAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA;AAAA,IACA;AAAA,IAIA,cAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA;AAAA,IACA;AAAA,IAIA,cAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA;AAAA,IACA;AAAA,IAIA,cAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA;AAAA,IACA;AAAA,IAaA,gBAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA,OAAA;AAAA,QACA,UAAA;AAAA,QACA,WAAA;AAAA,QACA,aAAA;AAAA,QACA,OAAA;AAAA,QACA,SAAA;AAAA,QACA,QAAA;AAAA,MACA;AAAA,MACA,WAAA,CAAAC,MAAA,OAAA,KAAAA,CAAA,EACA,MAAA,CAAAC,MAAA,CAAA,YAAA,aAAA,eAAA,SAAA,WAAA,QAAA,EAAA,SAAAA,CAAA,CAAA;AAAA,IACA;AAAA,IAMA,aAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA;AAAA,MACA,WAAA,CAAAD,MAAA,CAAA,UAAA,QAAA,EAAA,SAAAA,CAAA;AAAA,IACA;AAAA,IAIA,UAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA,MAAA,CAAA;AAAA,IACA;AAAA,IAIA,UAAA;AAAA,MACA,MAAA;AAAA,MACA,SAAA;AAAA,IACA;AAAA,EACA;AAAA,EACA,OAAA;AACA,WAAA;AAAA,MACA,eAAA;AAAA,MACA,SAAA;AAAA,MACA,YAAA;AAAA,MACA,cAAA;AAAA,MACA,YAAA;AAAA,IACA;AAAA,EACA;AAAA,EACA,UAAA;AAAA,IAEA,SAAA;AAAA,MACA,MAAA;AACA,eAAA,KAAA,cAAA,KAAA;AAAA,MACA;AAAA,MACA,IAAAA,GAAA;AACA,aAAA,aAAAA;AAAA,MACA;AAAA,IACA;AAAA,EACA;AAAA,EACA,OAAA;AAAA,IACA,YAAA;AAAA,MACA,QAAAA,GAAA;AAGA,QAAA,KAAA,QAAA,KAAA,UAAAA,CAAA,MAAA,KAAA,UAAA,KAAA,IAAA,KAQA,KAAA,MAAA,eAAAA,CAAA;AAAA,MAEA;AAAA,MACA,MAAA;AAAA,IACA;AAAA,IACA,MAAA;AAAA,MACA,QAAAA,GAAA;AACA,QAAA,KAAA,UAAAA,CAAA,MAAA,KAAA,UAAA,KAAA,UAAA,MACA,KAAA,UAAA,KAAA,MAAA,KAAA,UAAAA,CAAA,CAAA;AAAA,MAEA;AAAA,MACA,MAAA;AAAA,MACA,WAAA;AAAA,IACA;AAAA,IAIA,KAAAA,GAAA;AACA,WAAA,gBAAA,IACAA,MACA,KAAA,UAAA,MAAA;AAEA,aAAA,MAAA,wBAAA,MAAA,EAAA,eAAA,GAAA,CAAA;AAAA,MACA,CAAA,GAEA,KAAA,eAAA,KAAA,MAAA,KAAA,UAAA,KAAA,IAAA,CAAA;AAAA,IAEA;AAAA,IAIA,SAAAA,GAAA;AACA,WAAA,YAAAA,CAAA;AAAA,IACA;AAAA,EACA;AAAA,EACA,UAAA;AAGA,SAAA,aAAA,KAAA,eAAA,IACA,CAAA,2BAAA,IACA,CAAA,6BAAA,0BAAA;AAAA,EACA;AAAA,EACA,SAAA;AAAA,IAOA,YAAAE,GAAA;AACA,MAAA,CAAAA,EAAA,WAKAA,EAAA,MAAA,KAAA,YACA,KAAA,MAAA,kBAAAA,EAAA,QACA,KAAA,UAAA,KAIAA,EAAA,OAAA,UACA,KAAA,MAAA,kBAAAA,EAAA,QACA,KAAA,MAAA,kBAAAA,EAAA,IAAA,WAAA,KAIAA,EAAA,OAAA,UACA,KAAA,MAAA,kBAAAA,EAAA,IAAA,MAAA,kBAAAA,EAAA,QACA,KAAA,MAAA,kBAAAA,EAAA,IAAA,MAAA,kBAAAA,EAAA,IAAA,WAAA;AAAA,IAEA;AAAA,IAQA,kBAAAC,GAAA;AAOA,WAAA,MAAA,kBAAAA,CAAA;AAAA,IACA;AAAA,IAOA,WAAAC,GAAAC,GAAA;AACA,WAAA,KAAA,KAAA,YAAAA,GAAAD,CAAA;AAAA,IACA;AAAA,IAQA,KAAA,EAAA,WAAAE,EAAA,GAAAD,GAAA;AAEA,UAAAC,MAAA,QAAAD,IAAA,IAAA,KACAC,MAAA,UAAAD,IAAA,KAAA,KAAA,QAAA,QAAA;AAEA,aAAA,MAAA,kBAAAA,GAAA,oBAAA,IACA,KAAA,MAAA,kBAAAA,GAAA,UAAA;AACA;AAAA,MACA;AAGA,YAAAE,IAAAD,MAAA,OAAAD,IAAA,IAAAA,IAAA,GACAG,IAAAH,GACAI,IAAA,KAAA;AACA,MAAAA,EAAA,OAAAF,GAAA,GAAAE,EAAA,OAAAD,GAAA,CAAA,EAAA,EAAA,GACA,KAAA,UAAAC,GAGA,KAAA,gBAAA,KAAA,eAAA,MACA,QAAA,SAAAF,IAAA,CAAA,EACA,QAAA,WAAA,KAAA,QAAA,MAAA,GAGA,KAAA,MAAA,kBAAAA,GAAA,oBAAA,IACA,KAAA,MAAA,kBAAAA,GAAA,UAAA;AAAA,IACA;AAAA,IAMA,QAAA;AACA,WAAA,UAAA,KAAA,MAAA,KAAA,UAAA,KAAA,YAAA,CAAA,GAGA,KAAA,MAAA,eAAA,KAAA,OAAA;AAAA,IACA;AAAA,IAKA,OAAA;AAMA,WAAA,MAAA,SAAA,KAAA,OAAA,GAEA,KAAA,eAAA,KAAA,MAAA,KAAA,UAAA,KAAA,OAAA,CAAA;AAAA,IACA;AAAA,IAOA,WAAAG,GAAAL,GAAA;AACA,YAAAM,IAAA,KAAA,QAAAN,GAAA,SACA,KAAA,eAAA,SAAA,KAAA,eAAA,SACAO,IAAA,KAAA,eAAAF,GAAA,QAAA,WAAAC,CAAA;AACA,UAAA,KAAA,kBAAAC,GAAA;AAEA,aAAA,gBAAA,IAEA,WAAA,MAAA;AACA,eAAA,gBAAAA;AAAA,QACA,GAAA,CAAA;AACA;AAAA,MACA;AACA,WAAA,gBAAAA;AAAA,IACA;AAAA,IAMA,iBAAA;AACA,aAAA,kBAAA,UACA,OAAA,iBAAA,oBAAA,OAAA,iBACA,UAAA,iBAAA,KACA,OAAA,UAAA,mBAAA;AAAA,IACA;AAAA,EACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}