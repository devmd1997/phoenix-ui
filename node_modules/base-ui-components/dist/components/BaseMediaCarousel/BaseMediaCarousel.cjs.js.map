{"version":3,"file":"BaseMediaCarousel.cjs.js","sources":["../../../src/components/BaseMediaCarousel/BaseMediaCarousel.vue"],"sourcesContent":["<template>\n  <transition name=\"grow\">\n    <div\n      v-if=\"showInt\"\n      ref=\"mediaCarousel\"\n      class=\"base-media-carousel\">\n      <div class=\"base-media-carousel__background\" />\n\n      <button\n        class=\"base-media-carousel__close\"\n        @click=\"hide\">\n        <base-icon\n          name=\"remove\" />\n      </button>\n\n      <div\n        :id=\"swiperId\"\n        class=\"swiper-container\">\n        <template\n          v-if=\"items.length > 1\">\n          <base-icon\n            name=\"prev\"\n            class=\"swiper-button swiper-button-prev\" />\n\n          <base-icon\n            name=\"next\"\n            class=\"swiper-button swiper-button-next\" />\n        </template>\n\n        <div class=\"swiper-wrapper\">\n          <div\n            v-for=\"(media, index) in items\"\n            :key=\"index\"\n            class=\"swiper-slide\">\n            <base-media-carousel-item\n              ref=\"baseMedia\"\n              :autoplay=\"index === initialSlide\"\n              :additional-info=\"media.additionalInfo\"\n              :allow-download=\"allowDownload\"\n              :current-slide-info=\"items.length > 1 ? `${index + 1} / ${items.length}` : ''\"\n              :display-name=\"media.title\"\n              :display-size=\"media.displaySize\"\n              :download-url=\"media.downloadUrl\"\n              :info-texts=\"infoTexts\"\n              :media-url=\"media.mediaUrl\"\n              :media-poster-url=\"media.mediaPosterUrl\"\n              :media-type=\"media.mediaType\"\n              :orientation=\"media.orientation\"\n              :previews=\"media.previews\"\n              :hls-start-level=\"media.hlsStartLevel\"\n              tabindex=\"0\"\n              @download=\"download\" />\n          </div>\n        </div>\n      </div>\n    </div>\n  </transition>\n</template>\n\n<script>\nimport BaseMediaCarouselItem from '@/components/BaseMediaCarousel/BaseMediaCarouselItem';\nimport BaseIcon from '@/components/BaseIcon/BaseIcon';\nimport popUpLock from '../../mixins/popUpLock';\n\n/**\n * Component allowing sliding through images,\n * audio, video (currently only hls format) and files\n */\n\nexport default {\n  name: 'BaseMediaCarousel',\n  components: {\n    BaseMediaCarouselItem,\n    BaseIcon,\n  },\n  mixins: [popUpLock],\n  props: {\n    /**\n     * items to display in a swiper carousel\n     *\n     * array of objects with the following **required** properties:\n     *  **title** `string` - the asset title\n     *  **mediaUrl** `string` - url of the medium to be displayed\n     *\n     *  additionally, type `video` also requires the following properties:\n     *  **mediaPosterUrl** `string` - url of image for poster property in html5 video tag\n     *  **displaySize** `Object` - set height and with from outside, needs to be an object with properties `height` and/or `width`.\n     *\n     *  **optional** properties:\n     *  **additionalInfo** `string[]` - additional info text below file name, an array of strings.\n     *  **downloadUrl** `string` - url for downloading the file\n     *  **mediaType** `string` - specify the media type - needs to be one of: `image`, `video`, `audio`, `pdf`. **Caveat**: if media type is not specified it is automatically determined from file ending!\n     *  **orientation** `number` - define how the image should be rotated (EXIF orientation values) (only for type `image`)\n     *  **previews** `Object[]` - specify an image `srcset` as an array of objects in the form `{ [mediawidth]: 'url' }` (only for type `image`)\n     *  **hlsStartLevel** `number` - define startLevel (size) of hls-video\n     *\n     */\n    items: {\n      type: Array,\n      default: () => [],\n    },\n    /**\n     * index of initial slide\n     *   this NEEDS to be provided if carousel should start with any other\n     *   than first image in items array\n     */\n    initialSlide: {\n      type: [Number, String],\n      default: 0,\n    },\n    /**\n     * define if download button should be shown and download be enabled\n     */\n    allowDownload: {\n      type: Boolean,\n      default: true,\n    },\n    /**\n     * define information texts for download and view (for pdfs) buttons\n     */\n    infoTexts: {\n      type: Object,\n      default: () => ({\n        download: 'Download',\n        view: 'View',\n      }),\n    },\n    /**\n     * steer the display of the lightbox\n     */\n    showPreview: {\n      type: Boolean,\n      default: false,\n    },\n    /**\n     * specify [swiper API options](https://swiperjs.com/swiper-api)\n     */\n    swiperOptions: {\n      type: Object,\n      default: () => ({\n        speed: 500,\n        keyboard: {\n          enabled: true,\n        },\n      }),\n    },\n  },\n  data() {\n    return {\n      showInt: this.showPreview,\n      // needed for popUpLock mixin\n      targetName: 'mediaCarousel',\n      swiper: null,\n      // eslint-disable-next-line\n      swiperId: `base-media-carousel__swiper${this._uid}`,\n      isMounted: false,\n    };\n  },\n  watch: {\n    showPreview(val) {\n      this.showInt = val;\n    },\n  },\n  mounted() {\n    this.isMounted = true;\n  },\n  updated() {\n    this.$nextTick(() => {\n      if (this.isMounted && this.showInt && this.swiper === null) {\n        this.initSwiper();\n        this.$el.addEventListener('keyup', e => this.escapeEvent(e));\n        this.$el.addEventListener('keydown', e => this.tabEvents(e));\n      }\n\n      if (!this.showInt) {\n        this.swiper = null;\n        this.$el.removeEventListener('keyup', e => this.escapeEvent(e));\n        this.$el.removeEventListener('keydown', e => this.tabEvents(e));\n      }\n    });\n  },\n  methods: {\n    /**\n     * hide preview\n     */\n    hide() {\n      /**\n       * triggered by clicking on close button\n       *\n       * @event hide\n       *\n       */\n      this.$emit('hide');\n    },\n    /**\n     * init Swiper\n     * control media after swipe\n     */\n    async initSwiper() {\n      // import swiper and plugins\n      // to avoid import/require issues in an SSR setup\n      // we import swiper when the component is already mounted\n      const { Swiper } = await import('swiper');\n      const { Keyboard } = await import('swiper');\n      const { Navigation } = await import('swiper');\n\n      const additionalOptions = {\n        init: false,\n        initialSlide: this.initialSlide,\n        navigation: {\n          nextEl: '.swiper-button-next',\n          prevEl: '.swiper-button-prev',\n        },\n        lazyPreloaderClass: 'base-media-preview-preloader',\n        // Threshold value in px.\n        // If \"touch distance\" will be lower than this value then swiper will not move\n        threshold: 10,\n        modules: [Navigation, Keyboard],\n      };\n\n      this.swiper = new Swiper(`#${this.swiperId}`, {\n        ...this.swiperOptions,\n        ...additionalOptions,\n      });\n\n      this.swiper.on('slideChange', () => {\n        this.mediaPause();\n      });\n\n      this.swiper.on('transitionEnd', () => {\n        // check if swiper is still there since this event is also called on swiper hide\n        if (this.swiper) {\n          // select active slide and set focus\n          const media = this.$refs.baseMedia[this.swiper.activeIndex];\n          media.$el.focus();\n        }\n      });\n\n      // calc of slide width is wrong on first initialization using component in ssr\n      // quickfix is to trigger resize after swiper init\n      // TODO: clarify and find better solution\n      this.swiper.on('init', () => {\n        // edge needs somehow setTimeout to trigger resize\n        setTimeout(() => {\n          window.dispatchEvent(new Event('resize'));\n        }, 0);\n      });\n\n      this.swiper.init();\n\n      // set focus to opened slide/media - otherwise esc key won't work on first slide\n      this.$refs.baseMedia[this.swiper.activeIndex].$el.focus();\n    },\n    /**\n     * pause media on previous slide\n     */\n    mediaPause() {\n      const media = this.$refs.baseMedia[this.swiper.previousIndex];\n\n      // video\n      if (media && media.$refs.baseMediaVideo) {\n        media.$refs.baseMediaVideo.pause();\n      }\n\n      // audio\n      if (media && media.$refs.baseMediaAudio) {\n        media.$refs.baseMediaAudio.pause();\n      }\n    },\n    /**\n     * intercept escape key event, hide modal\n     */\n    escapeEvent(e) {\n      if (e.key === 'Escape') {\n        this.hide();\n      }\n    },\n    /**\n     * intercept tab key event\n     * due swiper breaks using tab keys\n     */\n    tabEvents(e) {\n      if (e.shiftKey && e.key === 'Tab') {\n        e.preventDefault();\n\n        this.setFocus('prev');\n        return;\n      }\n\n      if (e.key === 'Tab') {\n        e.preventDefault();\n        this.setFocus('next');\n      }\n    },\n    /**\n     * get focusable dom elements per slide\n     *\n     * @return array\n     */\n    getFocusableItems() {\n      const focusable = 'button, audio, video[tabindex=\"0\"]';\n      const focusableBySlide = [];\n\n      this.$refs.baseMedia.forEach((slide) => {\n        // focusable dom elements\n        const items = Array.from(slide.$el.querySelectorAll(focusable));\n        // add current slide (is focused after slide change)\n        items.unshift(slide.$el);\n\n        focusableBySlide.push(items);\n      });\n\n      return focusableBySlide;\n    },\n    /**\n     * set focus to prev/next focusable dom element\n     * trigger slideEvent if needed\n     *\n     * @param {string} direction 'prev', 'next'\n     */\n    setFocus(direction = 'next') {\n      const items = this.getFocusableItems();\n      let currentSlide;\n      let currentFocus;\n\n      items.forEach((item, itemIndex) => {\n        item.forEach((element, elemIndex) => {\n          if (element.matches(':focus')) {\n            currentSlide = itemIndex;\n            currentFocus = elemIndex;\n          }\n        });\n      });\n\n      if (direction === 'next') {\n        if (items[currentSlide] && items[currentSlide][currentFocus + 1]) {\n          items[currentSlide][currentFocus + 1].focus();\n          return;\n        }\n        this.swiper.slideNext();\n      }\n\n      if (direction === 'prev') {\n        if (items[currentSlide] && items[currentSlide][currentFocus - 1]) {\n          items[currentSlide][currentFocus - 1].focus();\n          return;\n        }\n        this.swiper.slidePrev();\n      }\n    },\n    download(value) {\n      /**\n       * download button clicked\n       *\n       * @event download\n       * @property {string} url - the download url\n       * @property {string} name - the file name\n       *\n       */\n      this.$emit('download', value);\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n  @import \"../../styles/variables\";\n\n  // import swiper styles\n  @import '../../../node_modules/swiper/swiper.scss';\n  @import '../../../node_modules/swiper/modules/navigation/navigation.scss';\n  @import '../../../node_modules/swiper/modules/pagination/pagination.scss';\n  @import '../../../node_modules/swiper/modules/keyboard/keyboard.scss';\n  @import '../../../node_modules/swiper/modules/autoplay/autoplay.scss';\n\n  .base-media-carousel {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: map-get($zindex, modal_bg);\n    display: flex;\n    overflow: hidden;\n\n    &__background {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n    }\n\n    &__close {\n      position: absolute;\n      top: $spacing-large;\n      right: $spacing-large;\n      width: $icon-large;\n      height: $icon-large;\n      color: white;\n      z-index: 5;\n      transition: color 250ms ease-in-out;\n\n      &:focus,\n      &:hover {\n        cursor: pointer;\n        color: $app-color;\n      }\n\n      svg {\n        width: 100%;\n        height: 100%;\n      }\n    }\n\n    &__slide {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n\n    &::v-deep {\n      .swiper-container {\n        width: 100%;\n      }\n\n      .swiper-button {\n        display: block;\n        width: calc(#{$icon-large} + (2 * #{$spacing-small}));\n        padding: 0 $spacing-small;\n        fill: white;\n        transform: translateY(-50%);\n        transition: fill 250ms ease-in-out;\n\n        &:focus,\n        &:hover {\n          fill: $app-color;\n        }\n\n        &-prev {\n          left: $spacing;\n        }\n\n        &-next {\n          right: $spacing;\n        }\n\n        @media screen and (max-width: $mobile) {\n          display: none;\n        }\n      }\n    }\n  }\n\n  .grow-enter-active,\n  .grow-leave-active {\n    transition: all 300ms ease-in-out;\n  }\n\n  .grow-enter, .grow-leave-to {\n    transform: scale(0.33);\n    opacity: 0;\n  }\n</style>\n"],"names":["_sfc_main","BaseMediaCarouselItem","BaseIcon","popUpLock","val","Swiper","_interopNamespace","Keyboard","Navigation","additionalOptions","media","focusable","focusableBySlide","slide","items","direction","currentSlide","currentFocus","item","itemIndex","element","elemIndex","value"],"mappings":"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"}