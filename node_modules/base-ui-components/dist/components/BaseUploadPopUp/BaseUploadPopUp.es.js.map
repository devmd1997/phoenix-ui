{"version":3,"file":"BaseUploadPopUp.es.js","sources":["../../../src/components/BaseUploadPopUp/BaseUploadPopUp.vue"],"sourcesContent":["<template>\n  <BasePopUp\n    :show=\"!!fileList.length\"\n    :title=\"getI18nTerm(getLangLabel(uploadText.title))\"\n    @close=\"cancelUpload\">\n    <transition-group name=\"list-complete\">\n      <div\n        v-if=\"userQuotaExceeded\"\n        key=\"user-warning\"\n        class=\"base-uploader-user-warning\">\n        <BaseIcon\n          name=\"attention\"\n          class=\"icon base-uploader-user-warning-icon\" />\n        {{ getI18nTerm(\n          getLangLabel(uploadText.quotaExceeded),\n          1,\n          { space: convertSpace(userSpace) }\n        ) }}\n      </div>\n\n      <div\n        key=\"upload-area\"\n        class=\"popup-upload-area\">\n        <transition-group\n          name=\"bar-move\"\n          class=\"transition\">\n          <BaseProgressBar\n            v-for=\"(file, index) of fileList\"\n            :key=\"file.name\"\n            :progress=\"uploadPercentage[index]\"\n            :file-name=\"file.name\"\n            :file-size=\"userQuotaExceeded ? convertSpace(file.size) : ''\"\n            :status=\"getStatus(file.name)\"\n            :error-message=\"getErrorMessage(file.name)\"\n            :show-remove=\"currentStatus === 'initial' && fileList.length > 1\"\n            class=\"upload-bar\"\n            @remove-item=\"removeFile(index)\" />\n        </transition-group>\n      </div>\n    </transition-group>\n\n    <!-- @slot slot for additional content after upload bars but before buttons -->\n    <slot />\n\n    <template slot=\"button-row\">\n      <BaseButton\n        v-if=\"currentStatus === 'initial' || currentStatus === 'failed'\"\n        :text=\"getI18nTerm(cancelButtonText)\"\n        :icon=\"'remove'\"\n        :icon-position=\"'right'\"\n        :icon-size=\"'small'\"\n        class=\"base-upload-bar-button\"\n        @clicked=\"cancelUpload\" />\n\n      <BaseButton\n        ref=\"uploadButton\"\n        :text=\"buttonText\"\n        :icon=\"currentStatus !== 'saving' && currentStatus !== 'failed' ? 'check-mark' : ''\"\n        :icon-position=\"'right'\"\n        :icon-size=\"'small'\"\n        :disabled=\"currentStatus === 'saving' || userQuotaExceeded\"\n        class=\"base-upload-bar-button\"\n        @clicked=\"startUpload\">\n        <template\n          v-if=\"currentStatus === 'saving'\"\n          slot=\"right-of-text\">\n          <span class=\"base-upload-bar-loader\">\n            <BaseLoader />\n          </span>\n        </template>\n      </BaseButton>\n    </template>\n  </BasePopUp>\n</template>\n\n<script>\nimport BaseButton from '../BaseButton/BaseButton';\nimport BaseIcon from '../BaseIcon/BaseIcon';\nimport BaseLoader from '../BaseLoader/BaseLoader';\nimport BasePopUp from '../BasePopUp/BasePopUp';\nimport BaseProgressBar from '../BaseProgressBar/BaseProgressBar';\nimport i18n from '../../mixins/i18n';\n\n/**\n * A component taking care of uploads within a pop up\n */\n\nexport default {\n  name: 'BaseUploadPopUp',\n  components: {\n    BaseButton,\n    BaseIcon,\n    BaseLoader,\n    BasePopUp,\n    BaseProgressBar,\n  },\n  mixins: [i18n],\n  props: {\n    /**\n     * register files to upload\n     * array with file-object(s) from file-input field\n     */\n    fileList: {\n      type: Array,\n      default: () => [],\n    },\n    /**\n     * define current status\n     * @values initial, saving, success, failed\n     */\n    currentStatus: {\n      type: String,\n      default: 'initial',\n      validate(val) {\n        return ['initial', 'saving', 'success', 'failed'].includes(val);\n      },\n    },\n    /**\n     * define button text\n     * could be string or path to i18n json as well\n     */\n    cancelButtonText: {\n      type: String,\n      default: 'cancel',\n    },\n    /**\n     * specify informational texts for the component -\n     * this needs to be an object with the following properties:\n     *\n     *   **title** `string` - text used in the popup header\n     *   **upload** `string` - default button text\n     *   **done** `string` - button text when upload finished\n     *   **retry** `string` - button text when an upload error occurs\n     *   **quotaExceeded** `- string` text used when user quota is exceeded\n     *\n     * The values of this object might be plain text or a key for an i18n file\n     */\n    uploadText: {\n      type: Object,\n      default: () => ({\n        title: 'File Upload',\n        upload: 'Upload',\n        done: 'Done',\n        retry: 'Try Again',\n        quotaExceeded: 'Unfortunately you exceeded your quota, because you have '\n          + 'only {space} of space left. Please remove some files to enable uploading.',\n      }),\n    },\n    /**\n     * current upload progress in percent per file\n     * array with current upload progress per file\n     * e.g. [11, 55, 100]\n     */\n    uploadPercentage: {\n      type: Array,\n      default: () => [],\n    },\n    /**\n     * define current free storage space (bytes)\n     */\n    userSpace: {\n      type: Number,\n      default: 10000000,\n    },\n    /**\n     * define rejected files\n     * array with filename(s)\n     */\n    rejectedFiles: {\n      type: Array,\n      default: () => [],\n    },\n    /**\n     * define uploaded files\n     * array with filename(s)\n     */\n    uploadedFiles: {\n      type: Array,\n      default: () => [],\n    },\n    /**\n     * define errors for rejected files\n     * array with objects\n     * eg: `[{ name: 'foo.txt', message: 'The file may include a virus' }]`\n     * Note: each object must contain the properties: `name`, `message`\n     */\n    fileErrors: {\n      type: Array,\n      default: () => [],\n      // checking if all necessary properties are part of the provided object\n      validator: (val) => {\n        if (val.length) {\n          return !['name', 'message']\n            .every(prop => Object.keys(val).includes(prop));\n        }\n        return true;\n      },\n    },\n  },\n  computed: {\n    buttonText() {\n      if (this.currentStatus === 'initial' || this.currentStatus === 'saving') {\n        return this.getI18nTerm(this.getLangLabel(this.uploadText.upload));\n      }\n      if (this.rejectedFiles.length) {\n        return this.getI18nTerm(this.getLangLabel(this.uploadText.retry));\n      }\n      return this.getI18nTerm(this.getLangLabel(this.uploadText.done));\n    },\n    userQuotaExceeded() {\n      return this.userSpace < this.fileList\n        .reduce((prev, curr) => prev + curr.size, 0);\n    },\n  },\n  methods: {\n    convertSpace(bytes, si) {\n      let newBytes = bytes;\n      const thresh = si ? 1000 : 1024;\n      if (Math.abs(bytes) < thresh) {\n        return `${bytes} B`;\n      }\n      const units = si\n        ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n        : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];\n      let u = -1;\n      do {\n        newBytes /= thresh;\n        u += 1;\n      } while (Math.abs(newBytes) >= thresh && u < units.length - 1);\n      return `${newBytes.toFixed(1)} ${units[u]}`;\n    },\n    getStatus(fileName) {\n      if (this.uploadedFiles.includes(fileName)) {\n        return 'success';\n      }\n      if (this.rejectedFiles.includes(fileName)) {\n        return 'fail';\n      }\n      return '';\n    },\n    getErrorMessage(fileName) {\n      if (this.fileErrors.find(file => file.name === fileName)) {\n        const { message } = this.fileErrors.find(file => file.name === fileName);\n        return message;\n      }\n      return '';\n    },\n    cancelUpload() {\n      /**\n       * Event emitted when cancel button is clicked\n       *\n       * @event cancel-upload\n       */\n      this.$emit('cancel-upload');\n    },\n    startUpload() {\n      /**\n       * Event emitted when upload button is clicked\n       *\n       * @event start-upload\n       */\n      this.$emit('start-upload');\n    },\n    removeFile(index) {\n      /**\n       * Event emitted when remove button on file entry is clicked\n       *\n       * @event remove-file\n       * @property {number} - index of the file entry\n       */\n      this.$emit('remove-file', index);\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n  @import \"../../styles/variables\";\n\n  .base-uploader-user-warning {\n    color: $warning-color;\n    fill: $warning-color;\n    margin-bottom: $spacing;\n    display: flex;\n    align-items: center;\n\n    .icon {\n      height: $icon-large;\n      width: $icon-large;\n      max-width: $icon-large;\n\n      &.base-uploader-user-warning-icon {\n        margin-right: $spacing-small;\n        flex: 0 0 auto;\n      }\n    }\n  }\n\n  .popup-text {\n    display: flex;\n    align-items: flex-end;\n    margin-top: $spacing;\n\n    .upload-dropdown {\n      width: calc(50% - #{$spacing-small});\n      flex: 0 0 auto;\n    }\n  }\n\n  .popup-text > div:first-of-type {\n    margin-right: $spacing;\n  }\n\n  .files-popup-input-field {\n    margin-bottom: $spacing;\n  }\n\n  .popup-upload-area {\n    max-height: 50vh;\n    overflow-y: auto;\n\n    .upload-bar:not(:last-child) {\n      margin-bottom: $spacing;\n    }\n  }\n\n  .base-upload-bar-button {\n    flex-basis: 100%;\n  }\n\n  .base-upload-bar-button + .base-upload-bar-button {\n    margin-left: $spacing;\n  }\n\n  .list-complete-enter, .list-complete-leave-to {\n    opacity: 0;\n    transform: translateY(-15px);\n  }\n\n  .list-complete-leave-active {\n    position: absolute;\n  }\n\n  .list-complete-move {\n    transition: all 200ms;\n  }\n\n  .transition {\n    display: flex;\n    flex-direction: column;\n  }\n\n  .bar-move-leave-active {\n    opacity: 0;\n    transition: all 250ms;\n  }\n\n  @media screen and (max-width: $mobile) {\n    .popup-upload-area {\n      max-height: ($row-height-small + $spacing) * 5;\n    }\n\n    .base-upload-bar-button + .base-upload-bar-button {\n      margin-left: 0;\n      margin-top: $spacing;\n    }\n  }\n\n  @media screen and (max-height: 600px) {\n    .popup-upload-area {\n      max-height: 40vh;\n    }\n  }\n  @media screen and (max-height: 500px) {\n    .popup-upload-area {\n      max-height: 40vh;\n    }\n  }\n  @media screen and (max-height: 400px) {\n    .popup-upload-area {\n      max-height: 30vh;\n    }\n  }\n  @media screen and (max-height: 300px) {\n    .popup-upload-area {\n      max-height: 20vh;\n    }\n  }\n</style>\n\n<style lang=\"scss\">\n@import \"../../styles/variables\";\n\n.base-upload-bar-loader {\n  position: relative;\n  transform: scale(0.5);\n  margin-left: $spacing;\n  padding-left: $spacing;\n}\n</style>\n"],"names":["_sfc_main","BaseButton","BaseIcon","BaseLoader","BasePopUp","BaseProgressBar","i18n","val","prop","prev","curr","bytes","si","newBytes","thresh","units","u","fileName","file","message","index"],"mappings":"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"}