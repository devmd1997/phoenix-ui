"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});require("./BaseMap.vue_vue_type_style_index_0_scoped_1e8cdfda_lang.cjs.js");require("./BaseMap.vue_vue_type_style_index_1_lang.cjs.js");const p=require("../../_virtual/_plugin-vue2_normalizer.cjs.js");function u(e){if(e&&e.__esModule)return e;const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const r in e)if(r!=="default"){const s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>e[r]})}}return t.default=e,Object.freeze(t)}const d={name:"BaseMap",props:{attribution:{type:String,default:'Source: <a href="https://openstreetmap.org/">OpenStreetMap contributors</a>'},attributionPosition:{type:String,default:"bottomright",validate:e=>["topright","bottomleft","bottomright"].includes(e)},centerMarker:{type:Number,default:null},clusterSizes:{type:Object,default:()=>({medium:5,large:20,xlarge:100}),validator:e=>e.medium&&e.large&&e.xlarge},copyright:{type:String,default:"<a href=http://creativecommons.org/licenses/by-sa/3.0/>CC BY-SA 3.0</a>"},highlightMarker:{type:Number,default:null},icon:{type:String,default:'<svg viewBox="0 0 70.866 70.866" xmlns="http://www.w3.org/2000/svg"><path d="m35.433 0a22.731 22.731 0 0 0-22.731 22.82 24.125 24.125 0 0 0 1.872 9.1814l19.611 38.063a1.3718 1.3718 0 0 0 2.496 0l19.611-38.063a22.249 22.249 0 0 0 1.872-9.1814 22.731 22.731 0 0 0-22.731-22.82zm0 32.858a10.216 10.216 0 1 1 10.216-10.216 10.241 10.241 0 0 1-10.216 10.216z" fill="#010101"/></svg>'},iconSize:{type:Number,default:32},options:{type:Object,default:()=>({})},marker:{type:Array,default:()=>[],validator:e=>e.every(t=>t.latLng||t.coordinates)},markerPopups:{type:Boolean,default:!0},maxZoom:{type:Number,default:18},url:{type:String,default:""},tileLayerService:{type:String,default:"WMTS",validator(e){return["WMTS","TMS","WMS"].includes(e)}},zoom:{type:Number,default:16}},data(){return{L:null,map:null,activePopUp:null,boundsPadding:[0,20],highlightedMarker:null,markerClass:"base-map-marker-icon",markerClusterClass:"base-map-marker-cluster",popupOptions:{offset:[10,-25],closeButton:!1,keepInView:!0},scrollWheelZoom:!1}},computed:{observer(){return new IntersectionObserver((e,t)=>{e.forEach(r=>{!r.isIntersecting||(t.unobserve(r.target),this.init())})})},cssProps(){return{"--leaflet-popup-offset-bottom":`${this.popupOptions.offset[1]}px`}},markerFiltered(){return Array.from(new Set(this.marker.map(JSON.stringify))).map(JSON.parse)}},watch:{centerMarker(e){e!==null&&this.map.setView(this.getLatLng(this.markerFiltered[e]),this.zoom)},highlightMarker(e,t){if(e!==null){this.map.closePopup(),this.resetAllMarker(),this.map.eachLayer(s=>{if(s._bounds&&s._icon){const l=this.getLatLng(this.markerFiltered[e]);if(this.L.latLngBounds(s._bounds).contains(l)){s._icon.classList.add(`${this.markerClusterClass}--active`);return}}s.options.id!=null&&s.options.id===e&&(this.highlightedMarker=s._icon,this.highlightedMarker.classList.add(`${this.markerClass}--active`))});return}this.highlightedMarker!=null&&this.activePopUp!==t&&(this.highlightedMarker.classList.remove(`${this.markerClass}--active`),this.highlightedMarker=null);const r=this.$el.querySelector(`.${this.markerClusterClass}--active`);r&&r.classList.remove(`${this.markerClusterClass}--active`)}},beforeDestroy(){this.observer.disconnect()},mounted(){this.observer.observe(this.$el)},methods:{async init(){if(this.L)return;this.L=await Promise.resolve().then(()=>u(require("leaflet")));const{ResponsivePopup:e}=await Promise.resolve().then(()=>u(require("leaflet-responsive-popup"))),{MarkerClusterGroup:t}=await Promise.resolve().then(()=>u(require("leaflet.markercluster")));this.map=this.L.map(this.$refs.mapElement,{scrollWheelZoom:this.scrollWheelZoom,tap:!1}),this.map.attributionControl.setPosition(this.attributionPosition);const r={maxZoom:this.maxZoom,attribution:[this.attribution,this.copyright].join(", "),tms:this.tileLayerService==="TMS",...this.options};if(this.tileLayerService==="WMS"?this.L.tileLayer.wms(this.url,r).addTo(this.map):this.L.tileLayer(this.url,r).addTo(this.map),!this.markerFiltered.length)return;const s={className:this.markerClass,html:this.icon,iconSize:[this.iconSize,this.iconSize],iconAnchor:[this.iconSize/2,this.iconSize]},l=this.L.divIcon(s);if(this.markerCluster=new t({maxClusterRadius:50,showCoverageOnHover:!1,iconCreateFunction:i=>{const n=i.getAllChildMarkers().length;let a="small",o=48;return n>this.clusterSizes.medium&&(a="medium",o=64),n>this.clusterSizes.large&&(a="large",o=80),n>this.clusterSizes.xlarge&&(a="xlarge",o=128),this.L.divIcon({html:`<div class="${this.markerClusterClass}__inner">${n}</div>`,className:`${this.markerClusterClass} ${this.markerClusterClass}--${a}`,iconSize:this.L.point(o,o)})}}),this.markerFiltered.forEach((i,n)=>{const a=new e(this.popupOptions),o={id:n,icon:l};if(!this.getLatLng(i))return;const h=this.L.marker(this.L.latLng(this.getLatLng(i)),o).on("mouseover",this.activateMarker).on("mouseout",this.resetMarker);this.markerPopups&&Array.isArray(i.data)&&(a.setContent(i.data.join("<br>")),h.bindPopup(a)),this.markerCluster.addLayer(h)}),this.map.addLayer(this.markerCluster),!this.markerFiltered.filter(i=>i.latLng||i.coordinates).length)return;const m=new this.L.LatLngBounds(this.markerFiltered.map(i=>this.getLatLng(i)));this.map.fitBounds(m,{padding:this.boundsPadding,maxZoom:this.zoom})},activateMarker(e){const{id:t}=e.target.options,r=e.target._icon;this.resetAllMarker(),e.target.options.active||(this.activePopUp=t,this.markerState(t),r.classList.add(`${this.markerClass}--active`),e.target.options.active=!0)},resetMarker(e){e.target._icon.classList.remove(`${this.markerClass}--active`),this.activePopUp=null,this.markerState(null),delete e.target.options.active},resetAllMarker(){this.map.eachLayer(e=>{const t=e._icon;t&&(t.classList.remove(`${this.markerClass}--active`),t.classList.remove(`${this.markerClusterClass}--active`),this.activePopUp=null,this.markerState(null),delete e.options.active)})},markerState(e){this.$emit("highlighted",e)},getLatLng(e){return e.coordinates?[e.coordinates[1],e.coordinates[0]]:e.latLng?e.latLng:null}}};var g=function(){var t=this,r=t._self._c;return r("div",{ref:"mapElement",staticClass:"base-map",style:t.cssProps})},f=[],k=p.default(d,g,f,!1,null,"1e8cdfda",null,null);const v=k.exports;exports.default=v;
//# sourceMappingURL=BaseMap.cjs.js.map
